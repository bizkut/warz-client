<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Initializing</title><link rel="stylesheet" href="ts3doc.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"><link rel="home" href="index.html" title="TeamSpeak 3 Server SDK Developer Manual"><link rel="up" href="index.html" title="TeamSpeak 3 Server SDK Developer Manual"><link rel="prev" href="ar01s04.html" title="Calling Server lib functions"><link rel="next" href="ar01s06.html" title="Querying the library version"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><img id="logo" src="images/logo.png"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Initializing</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s04.html"><img src="images/prev.png" alt="Prev"></a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s06.html"><img src="images/next.png" alt="Next"></a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="s_initializing"></a>Initializing</h2></div></div></div><p>When starting the server application, initialize the Server Lib with
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3server_initServerLib</b>(</code></td><td><var class="pdparam">functionPointers</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">usedLogTypes</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">logFileFolder</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>const struct ServerLibFunctions* <var class="pdparam">functionPointers</var></code>;<br><code>int <var class="pdparam">usedLogTypes</var></code>;<br><code>const char* <var class="pdparam">logFileFolder</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>This function must not be called more than once.</p></td></tr></table></div><div class="itemizedlist"><p class="title"><b>Parameters</b></p><ul type="disc"><li><p><em class="parameter"><code>functionPointers</code></em></p><p>Callback function pointers. See <a class="link" href="ar01s05.html#s_callback" title="The callback mechanism">below</a>.</p></li><li><p><em class="parameter"><code>usedLogTypes</code></em></p><p>Defines the log output types. The Server Lib can output log messages to a file (located in the <code class="filename">logs</code> directory relative to the server executable), to stdout or to user defined callbacks. If user callbacks are activated, the <a class="link" href="ar01s13.html#s_userloggingevent"><code class="function">onUserLoggingMessageEvent</code></a> event needs to be implemented.</p><p>Available values are defined by the enum <span class="structname">LogTypes</span> (see <code class="filename">public_definitions.h</code>):</p><pre class="programlisting">enum LogTypes {
    LogType_NONE          = 0x0000,
    LogType_FILE          = 0x0001,
    LogType_CONSOLE       = 0x0002,
    LogType_USERLOGGING   = 0x0004,
    LogType_NO_NETLOGGING = 0x0008,
    LogType_DATABASE      = 0x0010,
};</pre><p>Multiple log types can be combined with a binary OR. If only <em class="structfield"><code>LogType_NONE</code></em> is used, local logging is disabled.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Logging to console can slow down the application on Windows. Hence we do not recommend to log to the console on Windows other than in debug builds.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p><em class="structfield"><code>LogType_NO_NETLOGGING</code></em> is no longer used. Previously this controlled if the Server Lib would send warning, error and critical log entries to a webserver for analysis. As netlogging does not occur anymore, this flag has no effect anymore.</p><p><em class="structfield"><code>LogType_DATABASE</code></em> is unused in SDK builds.</p></td></tr></table></div></li><li><p><em class="parameter"><code>logFileFolder</code></em></p><p>Location where the logfiles produced if file logging is enabled will be saved to. Pass NULL for the default behaviour, which is to use a folder called <code class="filename">logs</code> in the current working directory.</p></li></ul></div><p>Returns <em class="structfield"><code>ERROR_ok</code></em> on success, otherwise an error code as defined in <code class="filename">public_errors.h</code>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="s_callback"></a>The callback mechanism</h3></div></div></div><p>The communication from the Server Lib to the server application takes place using callbacks. The server application has to define a series of function pointers using the struct ServerLibFunctions (see <code class="filename">serverlib.h</code>). These callbacks are used to let the server application hook into the library and receive notifaction on certain actions.</p><p>A callback example in C:</p><pre class="programlisting">static void my_onClientConnected_callback(uint64 serverID, anyID clientID, uint64 channelID,
                                          unsigned int* removeClientError) {
    printf("Client %u connected on virtual server %u joining channel %u", clientID, serverID, channelID);
}</pre><p>C++ developers can also use static member functions for the callbacks.</p><p>Before calling <code class="function">ts3server_initServerLib</code>, create an instance of struct ServerLibFunctions, initialize all function pointers with NULL and point the structs function pointers to your implemented callback functions:
</p><pre class="programlisting">unsigned int error;

/* Create struct */
ServerLibFunctions slFuncs;

/* Initialize all function pointers with NULL */
memset(&amp;slFuncs, 0, sizeof(struct ServerLibFunctions));

/* Assign those function pointers you implemented */
slFuncs.onVoiceDataEvent           = my_onVoiceDataEvent_callback;
slFuncs.onClientStartTalkingEvent  = my_onClientStartTalkingEvent_callback;
slFuncs.onClientStopTalkingEvent   = my_onClientStopTalkingEvent_callback;
slFuncs.onClientConnected          = my_onClientConnected_callback;
slFuncs.onClientDisconnected       = my_onClientDisconnected_callback;
slFuncs.onClientMoved              = my_onClientMoved_callback;
slFuncs.onChannelCreated           = my_onChannelCreated_callback;
slFuncs.onChannelEdited            = my_onChannelEdited_callback;
slFuncs.onChannelDeleted           = my_onChannelDeleted_callback;
slFuncs.onServerTextMessageEvent   = my_onServerTextMessageEvent_callback;
slFuncs.onChannelTextMessageEvent  = my_onChannelTextMessageEvent_callback;
slFuncs.onUserLoggingMessageEvent  = my_onUserLoggingMessageEvent_callback;
slFuncs.onAccountingErrorEvent     = my_onAccountingErrorEvent_callback;
slFuncs.onCustomPacketEncryptEvent = NULL;  // Not used by your application
slFuncs.onCustomPacketDecryptEvent = NULL;  // Not used by your application

/* Initialize library with callback function pointers */
error = ts3server_initServerLib(&amp;slFuncs, LogType_FILE | LogType_CONSOLE);
if(error != ERROR_ok) {
    printf("Error initializing serverlib: %d\n", error);
    (...)
}</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>As long as you initialize unimplemented callbacks with NULL, the Server Lib won't attempt to call those function pointers. However, if you leave unimplemented callbacks undefined, the Server Lib will crash when trying to call them.</p></td></tr></table></div><p>The individual callbacks are described in the chapter <a class="link" href="ar01s13.html" title="Events">Events</a>.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s04.html"><img src="images/prev.png" alt="Prev"></a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s06.html"><img src="images/next.png" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">Calling Server lib functions </td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a></td><td width="40%" align="right" valign="top"> Querying the library version</td></tr></table></div></body></html>
